<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoveyoTech | Client Management Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6C63FF;
            --secondary: #4ECDC4;
            --dark: #2C3E50;
            --light: #F8F9FA;
            --success: #28A745;
            --warning: #FFC107;
            --danger: #DC3545;
            --gray: #6C757D;
            --light-gray: #E9ECEF;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #F5F7FB;
            color: var(--dark);
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--dark);
            color: white;
            padding: 20px 0;
            transition: all 0.3s;
        }
        
        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .logo h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .logo h1 i {
            color: var(--primary);
        }
        
        .menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .menu-item:hover, .menu-item.active {
            background: rgba(255,255,255,0.1);
            border-left: 4px solid var(--primary);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .page-title {
            font-size: 24px;
            font-weight: 600;
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        /* Stats */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .stat-info h3 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .stat-info p {
            color: var(--gray);
            font-size: 14px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #5752d6;
        }
        
        /* Tables */
        .table-responsive {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        table th, table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }
        
        table th {
            font-weight: 600;
            color: var(--gray);
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .status-active {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }
        
        .status-pending {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
        }
        
        .status-closed {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 500;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Charts */
        .chart-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .chart-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        @media (max-width: 992px) {
            .chart-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* Utilities */
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }
        
        .d-flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }
        .gap-10 { gap: 10px; }
        
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        
        /* Mobile Toggle Button */
        .mobile-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .mobile-toggle:hover {
            background: #5a52ff;
        }

        /* Mobile Overlay */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .mobile-overlay.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .mobile-toggle {
                display: block;
            }
            
            .sidebar {
                width: 280px;
                position: fixed;
                top: 0;
                left: -280px;
                z-index: 1000;
                transition: left 0.3s ease;
                height: 100vh;
                overflow-y: auto;
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .main-content {
                margin-left: 0;
                padding: 60px 15px 20px;
                width: 100%;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .page-title {
                font-size: 20px;
            }
            
            .d-flex {
                flex-direction: column;
                width: 100%;
                gap: 10px;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-card h3 {
                font-size: 18px;
            }
            
            .chart-container {
                flex-direction: column;
                gap: 20px;
            }
            
            .chart-card {
                width: 100%;
                padding: 15px;
            }
            
            .card {
                margin-bottom: 15px;
            }
            
            .card-header {
                padding: 15px;
            }
            
            .card-body {
                padding: 15px;
            }
            
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            table {
                min-width: 600px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-control {
                padding: 10px;
                font-size: 14px;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .tabs {
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .tab {
                padding: 8px 12px;
                font-size: 14px;
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
            
            .analytics-tab-content {
                padding: 15px;
            }
            
            .row {
                margin: 0;
            }
            
            .col-md-6 {
                width: 100%;
                padding: 0;
                margin-bottom: 15px;
            }
            
            /* Payment tracking mobile styles */
            #paymentTracking {
                padding: 10px;
            }
            
            #paymentTracking .form-control {
                margin-bottom: 10px;
            }
            
            /* Service type management mobile */
            .service-type-form {
                flex-direction: column;
                gap: 10px;
            }
            
            .service-type-form .form-control {
                flex: 1;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 60px 10px 20px;
            }
            
            .stats-container {
                gap: 10px;
            }
            
            .stat-card {
                padding: 12px;
            }
            
            .stat-card h3 {
                font-size: 16px;
            }
            
            .stat-card p {
                font-size: 12px;
            }
            
            .card-header h2 {
                font-size: 18px;
            }
            
            .page-title {
                font-size: 18px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .form-control {
                padding: 8px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Toggle Button -->
    <button class="mobile-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" onclick="closeSidebar()"></div>
    
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <h1><img src="logo.png" alt="Company Logo" style="height: 75px; width: auto; display: block; margin: 0 auto;"></h1>
        </div>
        <div class="menu-item active">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </div>
        <div class="menu-item">
            <i class="fas fa-users"></i>
            <span>Clients</span>
        </div>
        <div class="menu-item">
            <i class="fas fa-file-invoice-dollar"></i>
            <span>Projects</span>
        </div>
        <div class="menu-item">
            <i class="fas fa-chart-line"></i>
            <span>Analytics</span>
        </div>
        <div class="menu-item">
            <i class="fas fa-handshake"></i>
            <span>Outreach</span>
        </div>
        <div class="menu-item">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <h1 class="page-title">Dashboard</h1>
            <div class="d-flex align-center gap-10">
                <div class="form-group" style="margin-bottom: 0; min-width: 250px;">
                    <input type="text" class="form-control" placeholder="Search...">
                </div>
                <button class="btn btn-primary"><i class="fas fa-plus"></i> New Client</button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(108, 99, 255, 0.1); color: var(--primary);">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="stat-info">
                    <h3>$24,560</h3>
                    <p>Total Revenue</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(78, 205, 196, 0.1); color: var(--secondary);">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <h3>42</h3>
                    <p>Active Clients</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(255, 193, 7, 0.1); color: var(--warning);">
                    <i class="fas fa-briefcase"></i>
                </div>
                <div class="stat-info">
                    <h3>18</h3>
                    <p>Ongoing Projects</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(220, 53, 69, 0.1); color: var(--danger);">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-info">
                    <h3>7</h3>
                    <p>Pending Proposals</p>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active">Client Management</div>
            <div class="tab">Revenue Analytics</div>
            <div class="tab">Outreach Tracking</div>
        </div>

        <!-- Client Management -->
        <div class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Add New Client</h2>
                </div>
                <form>
                    <div class="form-group">
                        <label for="clientName">Client Name</label>
                        <input type="text" class="form-control" id="clientName" placeholder="Enter client name">
                    </div>
                    <div class="form-group">
                        <label for="clientEmail">Email Address</label>
                        <input type="email" class="form-control" id="clientEmail" placeholder="Enter email">
                    </div>
                    <div class="form-group">
                        <label for="serviceType">Service Type</label>
                        <select class="form-control" id="serviceType">
                            <option value="">Select service type</option>
                            <option value="logo">Logo Design</option>
                            <option value="branding">Branding Package</option>
                            <option value="web">Web Design</option>
                            <option value="social">Social Media Graphics</option>
                            <option value="print">Print Design</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Engagement Type</label>
                        <div>
                            <input type="radio" id="contract" name="engagementType" value="contract">
                            <label for="contract">Contract</label>
                            <input type="radio" id="onetime" name="engagementType" value="onetime" style="margin-left: 15px;">
                            <label for="onetime">One-Time</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="projectValue">Project Value</label>
                        <input type="number" class="form-control" id="projectValue" placeholder="Enter amount">
                    </div>
                    <div class="form-group">
                        <label for="depositPaid">Deposit Paid</label>
                        <select class="form-control" id="depositPaid">
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Client</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Current Clients</h2>
                </div>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Service</th>
                                <th>Type</th>
                                <th>Value</th>
                                        <th>Payment Status</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Sarah Johnson</td>
                                <td>Branding Package</td>
                                <td>Contract</td>
                                <td>$4,500</td>
                                <td class="text-success">Paid</td>
                                <td><span class="status-badge status-active">Active</span></td>
                                <td>
                                    <i class="fas fa-edit" style="color: var(--primary); cursor: pointer;"></i>
                                    <i class="fas fa-trash" style="color: var(--danger); cursor: pointer; margin-left: 10px;"></i>
                                </td>
                            </tr>
                            <tr>
                                <td>TechStart Inc.</td>
                                <td>Web Design</td>
                                <td>Contract</td>
                                <td>$7,200</td>
                                <td class="text-success">Paid</td>
                                <td><span class="status-badge status-active">Active</span></td>
                                <td>
                                    <i class="fas fa-edit" style="color: var(--primary); cursor: pointer;"></i>
                                    <i class="fas fa-trash" style="color: var(--danger); cursor: pointer; margin-left: 10px;"></i>
                                </td>
                            </tr>
                            <tr>
                                <td>Local Cafe</td>
                                <td>Logo Design</td>
                                <td>One-Time</td>
                                <td>$800</td>
                                <td class="text-warning">Pending</td>
                                <td><span class="status-badge status-pending">Proposal Sent</span></td>
                                <td>
                                    <i class="fas fa-edit" style="color: var(--primary); cursor: pointer;"></i>
                                    <i class="fas fa-trash" style="color: var(--danger); cursor: pointer; margin-left: 10px;"></i>
                                </td>
                            </tr>
                            <tr>
                                <td>Fitness First</td>
                                <td>Social Media Graphics</td>
                                <td>Contract</td>
                                <td>$2,400</td>
                                <td class="text-success">Paid</td>
                                <td><span class="status-badge status-active">Active</span></td>
                                <td>
                                    <i class="fas fa-edit" style="color: var(--primary); cursor: pointer;"></i>
                                    <i class="fas fa-trash" style="color: var(--danger); cursor: pointer; margin-left: 10px;"></i>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Revenue Analytics -->
        <div class="tab-content">
            <div class="chart-container">
                <div class="chart-card">
                    <h2 class="card-title mb-20">Revenue by Service Type</h2>
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="chart-card">
                    <h2 class="card-title mb-20">Monthly Revenue</h2>
                    <canvas id="monthlyRevenueChart"></canvas>
                </div>
            </div>
            
            <div class="card mt-20">
                <div class="card-header">
                    <h2 class="card-title">Revenue Summary</h2>
                </div>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Service Type</th>
                                <th>Number of Projects</th>
                                <th>Total Revenue</th>
                                <th>Average Project Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Logo Design</td>
                                <td>12</td>
                                <td>$9,600</td>
                                <td>$800</td>
                            </tr>
                            <tr>
                                <td>Branding Package</td>
                                <td>8</td>
                                <td>$28,500</td>
                                <td>$3,562</td>
                            </tr>
                            <tr>
                                <td>Web Design</td>
                                <td>5</td>
                                <td>$31,200</td>
                                <td>$6,240</td>
                            </tr>
                            <tr>
                                <td>Social Media Graphics</td>
                                <td>15</td>
                                <td>$12,000</td>
                                <td>$800</td>
                            </tr>
                            <tr>
                                <td>Print Design</td>
                                <td>7</td>
                                <td>$8,400</td>
                                <td>$1,200</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Outreach Tracking -->
        <div class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Add New Prospect</h2>
                </div>
                <form>
                    <div class="form-group">
                        <label for="prospectName">Prospect Name</label>
                        <input type="text" class="form-control" id="prospectName" placeholder="Enter prospect name">
                    </div>
                    <div class="form-group">
                        <label for="prospectCompany">Company</label>
                        <input type="text" class="form-control" id="prospectCompany" placeholder="Enter company name">
                    </div>
                    <div class="form-group">
                        <label for="prospectEmail">Email Address</label>
                        <input type="email" class="form-control" id="prospectEmail" placeholder="Enter email">
                    </div>
                    <div class="form-group">
                        <label for="prospectPhone">Phone Number</label>
                        <input type="tel" class="form-control" id="prospectPhone" placeholder="Enter phone number">
                    </div>
                    <div class="form-group">
                        <label for="proposedService">Proposed Service</label>
                        <select class="form-control" id="proposedService">
                            <option value="">Select service type</option>
                            <option value="logo">Logo Design</option>
                            <option value="branding">Branding Package</option>
                            <option value="web">Web Design</option>
                            <option value="social">Social Media Graphics</option>
                            <option value="print">Print Design</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Prospect</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Prospect Pipeline</h2>
                </div>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Prospect</th>
                                <th>Company</th>
                                <th>Contact</th>
                                <th>Proposed Service</th>
                                <th>Proposal Sent</th>
                                <th>Response</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Michael Roberts</td>
                                <td>GreenTech Solutions</td>
                                <td>michael@greentech.com</td>
                                <td>Web Design</td>
                                <td>2023-06-15</td>
                                <td>Positive</td>
                                <td><span class="status-badge status-active">Follow-up Scheduled</span></td>
                            </tr>
                            <tr>
                                <td>Jennifer Lee</td>
                                <td>Fashion Boutique</td>
                                <td>jennifer@fboutique.com</td>
                                <td>Branding Package</td>
                                <td>2023-06-20</td>
                                <td>No Response</td>
                                <td><span class="status-badge status-pending">Awaiting Response</span></td>
                            </tr>
                            <tr>
                                <td>David Wilson</td>
                                <td>Wilson Legal</td>
                                <td>david@wilsonlegal.com</td>
                                <td>Logo Design</td>
                                <td>2023-06-10</td>
                                <td>Negative</td>
                                <td><span class="status-badge status-closed">Not Interested</span></td>
                            </tr>
                            <tr>
                                <td>Emily Chen</td>
                                <td>StartUp Innovate</td>
                                <td>emily@startupinnovate.com</td>
                                <td>Social Media Graphics</td>
                                <td>2023-06-18</td>
                                <td>Positive</td>
                                <td><span class="status-badge status-active">Meeting Scheduled</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global data storage
        let clients = JSON.parse(localStorage.getItem('clients')) || [
            {
                id: 1,
                name: 'Sarah Johnson',
                email: 'sarah@example.com',
                phone: '+254 700 123 456',
                service: 'Branding Package',
                type: 'Contract',
                contractDuration: 'monthly',
                value: 4500,
                paymentStatus: 'fully-paid',
                paidAmount: 4500,
                status: 'Active',
                monthlyPayments: [
                    { date: '2023-06-01', amount: 1500 },
                    { date: '2023-07-01', amount: 1500 },
                    { date: '2023-08-01', amount: 1500 }
                ]
            },
            {
                id: 2,
                name: 'TechStart Inc.',
                email: 'contact@techstart.com',
                phone: '+254 700 234 567',
                service: 'Web Design',
                type: 'Contract',
                contractDuration: 'quarterly',
                value: 7200,
                paymentStatus: 'deposit',
                paidAmount: 3600,
                status: 'Active',
                monthlyPayments: [
                    { date: '2023-06-01', amount: 3600 }
                ]
            },
            {
                id: 3,
                name: 'Local Cafe',
                email: 'owner@localcafe.com',
                phone: '+254 700 345 678',
                service: 'Logo Design',
                type: 'One-Time',
                contractDuration: null,
                value: 800,
                paymentStatus: 'deposit',
                paidAmount: 400,
                status: 'Paused',
                monthlyPayments: []
            },
            {
                id: 4,
                name: 'Fitness First',
                email: 'manager@fitnessfirst.com',
                phone: '+254 700 456 789',
                service: 'Social Media Graphics',
                type: 'Contract',
                contractDuration: 'weekly',
                value: 2400,
                paymentStatus: 'fully-paid',
                paidAmount: 2400,
                status: 'Active',
                monthlyPayments: [
                    { date: '2023-06-01', amount: 600 },
                    { date: '2023-06-08', amount: 600 },
                    { date: '2023-06-15', amount: 600 },
                    { date: '2023-06-22', amount: 600 }
                ]
            }
        ];

        let prospects = JSON.parse(localStorage.getItem('prospects')) || [
            {
                id: 1,
                name: 'Michael Roberts',
                company: 'GreenTech Solutions',
                email: 'michael@greentech.com',
                phone: '(555) 123-4567',
                service: 'Web Design',
                proposalSent: '2023-06-15',
                response: 'Positive',
                status: 'Follow-up Scheduled'
            },
            {
                id: 2,
                name: 'Jennifer Lee',
                company: 'Fashion Boutique',
                email: 'jennifer@fboutique.com',
                phone: '(555) 234-5678',
                service: 'Branding Package',
                proposalSent: '2023-06-20',
                response: 'No Response',
                status: 'Awaiting Response'
            },
            {
                id: 3,
                name: 'David Wilson',
                company: 'Wilson Legal',
                email: 'david@wilsonlegal.com',
                phone: '(555) 345-6789',
                service: 'Logo Design',
                proposalSent: '2023-06-10',
                response: 'Negative',
                status: 'Not Interested'
            },
            {
                id: 4,
                name: 'Emily Chen',
                company: 'StartUp Innovate',
                email: 'emily@startupinnovate.com',
                phone: '(555) 456-7890',
                service: 'Social Media Graphics',
                proposalSent: '2023-06-18',
                response: 'Positive',
                status: 'Meeting Scheduled'
            }
        ];

        let projects = JSON.parse(localStorage.getItem('projects')) || [
            {
                id: 1,
                clientId: 1,
                clientName: 'Sarah Johnson',
                projectName: 'Complete Brand Identity Package',
                service: 'Branding Package',
                status: 'In Progress',
                startDate: '2023-06-01',
                dueDate: '2023-07-15',
                progress: 65,
                value: 4500,
                description: 'Complete brand identity including logo, business cards, letterhead, and brand guidelines'
            },
            {
                id: 2,
                clientId: 2,
                clientName: 'TechStart Inc.',
                projectName: 'Corporate Website Redesign',
                service: 'Web Design',
                status: 'In Progress',
                startDate: '2023-06-10',
                dueDate: '2023-08-01',
                progress: 40,
                value: 7200,
                description: 'Complete website redesign with modern UI/UX and responsive design'
            },
            {
                id: 3,
                clientId: 3,
                clientName: 'Local Cafe',
                projectName: 'Logo Design & Business Cards',
                service: 'Logo Design',
                status: 'Not Started',
                startDate: '2023-07-01',
                dueDate: '2023-07-20',
                progress: 0,
                value: 800,
                description: 'Logo design and business card layout for local cafe'
            },
            {
                id: 4,
                clientId: 4,
                clientName: 'Fitness First',
                projectName: 'Monthly Social Media Graphics',
                service: 'Social Media Graphics',
                status: 'Completed',
                startDate: '2023-05-01',
                dueDate: '2023-06-30',
                progress: 100,
                value: 2400,
                description: 'Monthly social media graphics package for fitness center'
            }
        ];


        // Save data to localStorage
        function saveData() {
            localStorage.setItem('clients', JSON.stringify(clients));
            localStorage.setItem('prospects', JSON.stringify(prospects));
            localStorage.setItem('projects', JSON.stringify(projects));
        }

        // Force reset data to defaults
        function resetDataToDefaults() {
            console.log('Resetting data to defaults');
            // Clear localStorage
            localStorage.removeItem('clients');
            localStorage.removeItem('prospects');
            localStorage.removeItem('projects');
            
            // Reload the page to get fresh default data
            location.reload();
        }

        // Force reset data function for manual use
        function forceResetData() {
            console.log('Force resetting data');
            localStorage.clear();
            
            // Clear all data arrays
            clients = [];
            prospects = [];
            projects = [];
            
            // Save empty data
            saveData();
            
            showNotification('All data has been force reset!', 'success');
            location.reload();
        }

        // Ensure data is properly initialized
        function ensureDataInitialized() {
            // Check if clients data exists in localStorage, if not, start with empty arrays
            if (!localStorage.getItem('clients')) {
                console.log('No clients data in localStorage, starting with empty data');
                // Initialize with empty arrays
                clients = [];
                prospects = [];
                projects = [];
                // Save empty data to localStorage
                saveData();
            } else {
                console.log('Loading clients from localStorage');
                // Reload data from localStorage to ensure we have the latest
                clients = JSON.parse(localStorage.getItem('clients')) || [];
                prospects = JSON.parse(localStorage.getItem('prospects')) || [];
                projects = JSON.parse(localStorage.getItem('projects')) || [];
            }
            
            // Ensure arrays are properly initialized
            if (!clients || !Array.isArray(clients)) {
                console.log('Clients array is invalid, resetting to empty array');
                clients = [];
            }
            if (!prospects || !Array.isArray(prospects)) {
                prospects = [];
            }
            if (!projects || !Array.isArray(projects)) {
                projects = [];
            }
            
            console.log('Data initialized - Clients:', clients.length, 'Prospects:', prospects.length, 'Projects:', projects.length);
            console.log('Client types:', clients.map(c => ({ name: c.name, type: c.type })));
            console.log('Contract clients:', clients.filter(c => c.type === 'Contract').map(c => ({ name: c.name, type: c.type })));
            
            // If we have no clients or the data seems corrupted, reset to defaults
            if (clients.length === 0) {
                console.log('No clients found, resetting to defaults');
                resetDataToDefaults();
            }
        }

        // Debug function to check data
        function debugData() {
            console.log('=== DEBUG DATA ===');
            console.log('Clients from localStorage:', JSON.parse(localStorage.getItem('clients') || '[]'));
            console.log('Current clients array:', clients);
            console.log('Contract clients:', clients.filter(c => c.type === 'Contract'));
            console.log('All client types:', clients.map(c => ({ name: c.name, type: c.type, id: c.id })));
            console.log('==================');
        }

        // Toggle contract options visibility
        function toggleContractOptions() {
            const contractRadio = document.getElementById('contract');
            const contractOptions = document.getElementById('contractOptions');
            
            if (contractRadio && contractOptions) {
                if (contractRadio.checked) {
                    contractOptions.style.display = 'block';
                } else {
                    contractOptions.style.display = 'none';
                }
            }
        }

        // Update client status based on payment and engagement type
        function updateClientStatus() {
            const paymentStatus = document.getElementById('paymentStatus');
            const engagementType = document.querySelector('input[name="engagementType"]:checked');
            const clientStatus = document.getElementById('clientStatus');
            
            if (paymentStatus && engagementType && clientStatus) {
                // If fully paid and one-time, automatically set to closed
                if (paymentStatus.value === 'fully-paid' && engagementType.value === 'onetime') {
                    clientStatus.value = 'Closed';
                } else if (paymentStatus.value === 'deposit' && (clientStatus.value === 'Closed' || clientStatus.value === 'Paused')) {
                    // If changed from fully paid to deposit, set back to active
                    clientStatus.value = 'Active';
                }
            }
        }

        // Toggle payment tracking visibility
        function togglePaymentTracking() {
            const contractDuration = document.getElementById('contractDuration');
            const paymentTracking = document.getElementById('paymentTracking');
            
            if (contractDuration && paymentTracking) {
                if (contractDuration.value === 'monthly') {
                    paymentTracking.style.display = 'block';
                    updatePaymentTrackingDisplay();
                } else {
                    paymentTracking.style.display = 'none';
                }
            }
        }

        // Update payment tracking display
        function updatePaymentTrackingDisplay() {
            const totalPaymentsCount = document.getElementById('totalPaymentsCount');
            const totalAmountPaid = document.getElementById('totalAmountPaid');
            
            if (totalPaymentsCount && totalAmountPaid) {
                // Get current client data if editing
                const currentClient = getCurrentEditingClient();
                if (currentClient && currentClient.monthlyPayments) {
                    const totalPayments = currentClient.monthlyPayments.length;
                    const totalAmount = currentClient.monthlyPayments.reduce((sum, payment) => sum + payment.amount, 0);
                    
                    totalPaymentsCount.textContent = totalPayments;
                    totalAmountPaid.textContent = `KSh ${totalAmount.toLocaleString()}`;
                } else {
                    totalPaymentsCount.textContent = '0';
                    totalAmountPaid.textContent = 'KSh 0';
                }
            }
        }

        // Get current client being edited
        function getCurrentEditingClient() {
            // This would be set when editing a client
            return window.currentEditingClient || null;
        }

        // Add manual payment
        function addManualPayment() {
            const currentClient = getCurrentEditingClient();
            if (!currentClient) {
                alert('Please save the client first before adding payments');
                return;
            }

            const manualAmount = parseFloat(document.getElementById('manualPaymentAmount').value) || 0;
            if (manualAmount <= 0) {
                alert('Please enter a valid payment amount');
                return;
            }

            const newPayment = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                amount: manualAmount
            };

            if (!currentClient.monthlyPayments) {
                currentClient.monthlyPayments = [];
            }
            
            currentClient.monthlyPayments.push(newPayment);
            currentClient.paidAmount = currentClient.monthlyPayments.reduce((sum, payment) => sum + payment.amount, 0);
            
            // Clear input
            document.getElementById('manualPaymentAmount').value = '';
            
            updatePaymentTrackingDisplay();
            updatePaymentHistory();
            showNotification(`Payment of KSh ${manualAmount.toLocaleString()} added successfully!`, 'success');
        }

        // Add full payment
        function addFullPayment() {
            const currentClient = getCurrentEditingClient();
            if (!currentClient) {
                alert('Please save the client first before adding payments');
                return;
            }

            const projectValue = parseFloat(document.getElementById('projectValue').value) || 0;
            if (projectValue <= 0) {
                alert('Please enter a valid project value first');
                return;
            }

            const newPayment = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                amount: projectValue
            };

            if (!currentClient.monthlyPayments) {
                currentClient.monthlyPayments = [];
            }
            
            currentClient.monthlyPayments.push(newPayment);
            currentClient.paidAmount = currentClient.monthlyPayments.reduce((sum, payment) => sum + payment.amount, 0);
            
            updatePaymentTrackingDisplay();
            updatePaymentHistory();
            showNotification(`Full payment of KSh ${projectValue.toLocaleString()} added successfully!`, 'success');
        }

        // Remove payment
        function removePayment(paymentId) {
            const currentClient = getCurrentEditingClient();
            if (!currentClient || !currentClient.monthlyPayments) return;

            if (confirm('Are you sure you want to remove this payment?')) {
                currentClient.monthlyPayments = currentClient.monthlyPayments.filter(p => p.id !== paymentId);
                currentClient.paidAmount = currentClient.monthlyPayments.reduce((sum, payment) => sum + payment.amount, 0);
                
                updatePaymentTrackingDisplay();
                updatePaymentHistory();
                showNotification('Payment removed successfully!', 'success');
            }
        }

        // Update payment history display
        function updatePaymentHistory() {
            const currentClient = getCurrentEditingClient();
            const paymentList = document.getElementById('paymentList');
            
            if (!paymentList) return;

            if (!currentClient || !currentClient.monthlyPayments || currentClient.monthlyPayments.length === 0) {
                paymentList.innerHTML = '<div style="text-align: center; color: #666; padding: 10px;">No payments recorded</div>';
                return;
            }

            paymentList.innerHTML = currentClient.monthlyPayments.map(payment => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: white; margin-bottom: 5px; border-radius: 4px; border: 1px solid #e9ecef;">
                    <div>
                        <span style="font-weight: bold;">KSh ${payment.amount.toLocaleString()}</span>
                        <br><small style="color: #666;">${new Date(payment.date).toLocaleDateString()}</small>
                    </div>
                    <button type="button" onclick="removePayment(${payment.id})" style="background: var(--danger); color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        // Switch analytics tabs
        function switchAnalyticsTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.analytics-tab-content');
            tabContents.forEach(content => {
                content.style.display = 'none';
            });

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.analytics-tab-content').length > 0 ? 
                document.querySelectorAll('.tabs .tab') : [];
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content
            const selectedTab = document.getElementById(`analytics-${tabName}`);
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }

            // Add active class to clicked tab
            const clickedTab = event.target;
            if (clickedTab) {
                clickedTab.classList.add('active');
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure data is properly initialized
            ensureDataInitialized();
            
            // Debug: Check if data is loaded
            console.log('Clients:', clients);
            console.log('Prospects:', prospects);
            console.log('Projects:', projects);
            
            initializeSidebar();
            initializeTabs();
            initializeForms();
            initializeSearch();
            updateStats();
            
            // Ensure sidebar navigation works globally
            document.addEventListener('click', function(e) {
                // Check if click is on sidebar menu item
                if (e.target.closest('.menu-item')) {
                    handleSidebarClick(e);
                }
            });
        });

        // Sidebar navigation - using event delegation for better reliability
        function initializeSidebar() {
            // Use event delegation on the sidebar to handle clicks
            const sidebar = document.querySelector('.sidebar');
            if (sidebar) {
                // Remove existing event listeners
                sidebar.removeEventListener('click', handleSidebarClick);
                // Add new event listener with event delegation
                sidebar.addEventListener('click', handleSidebarClick);
            }
        }

        function handleSidebarClick(e) {
            // Check if clicked element is a menu item or inside a menu item
            const menuItem = e.target.closest('.menu-item');
            if (!menuItem) return;

            e.preventDefault();
            
            // Remove active class from all menu items
            const allMenuItems = document.querySelectorAll('.menu-item');
            allMenuItems.forEach(mi => mi.classList.remove('active'));
            
            // Add active class to clicked item
            menuItem.classList.add('active');
            
            // Get menu text
            const menuText = menuItem.querySelector('span').textContent;
            
            // Close sidebar on mobile after selection
            handleMobileMenuClick();
            
            // Show/hide relevant sections based on menu selection
            handleMenuNavigation(menuText);
        }

        function handleMenuNavigation(menuText) {
            // Ensure data consistency before switching pages
            ensureDataConsistency();
            
            // Update page title
            const pageTitle = document.querySelector('.page-title');
            if (pageTitle) {
                pageTitle.textContent = menuText;
            }
            
            switch(menuText) {
                case 'Dashboard':
                    showDashboard();
                    break;
                case 'Clients':
                    showClients();
                    break;
                case 'Projects':
                    showProjectsPage();
                    break;
                case 'Analytics':
                    showAnalytics();
                    break;
                case 'Outreach':
                    showOutreach();
                    break;
                case 'Settings':
                    showSettings();
                    break;
            }
        }

        function showDashboard() {
            const mainContent = document.querySelector('.main-content');
            mainContent.innerHTML = `
                <div class="header">
                    <h1 class="page-title">Dashboard</h1>
                    <div class="d-flex align-center gap-10">
                        <div class="form-group" style="margin-bottom: 0; min-width: 250px;">
                            <input type="text" class="form-control" placeholder="Search...">
                        </div>
                        <button class="btn btn-primary"><i class="fas fa-plus"></i> New Client</button>
                    </div>
                </div>

                <!-- Stats -->
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(108, 99, 255, 0.1); color: var(--primary);">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalRevenue">KSh ${clients.reduce((sum, client) => sum + (client.paidAmount || 0), 0).toLocaleString()}</h3>
                            <p>Total Revenue</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(78, 205, 196, 0.1); color: var(--secondary);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="activeClients">${clients.filter(c => c.status === 'Active').length}</h3>
                            <p>Active Clients</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(255, 193, 7, 0.1); color: var(--warning);">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="ongoingProjects">${projects.filter(p => p.status === 'Active' || p.status === 'In Progress').length}</h3>
                            <p>Ongoing Projects</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(220, 53, 69, 0.1); color: var(--danger);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="pendingProposals">${prospects.filter(p => p.status === 'Awaiting Response').length}</h3>
                            <p>Pending Proposals</p>
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active">Client Management</div>
                    <div class="tab">Revenue Analytics</div>
                    <div class="tab">Outreach Tracking</div>
                </div>

                <!-- Client Management -->
                <div class="tab-content active">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Add New Client</h2>
                        </div>
                        <form>
                            <div class="form-group">
                                <label for="clientName">Client Name</label>
                                <input type="text" class="form-control" id="clientName" placeholder="Enter client name">
                            </div>
                            <div class="form-group">
                                <label for="clientEmail">Email Address</label>
                                <input type="email" class="form-control" id="clientEmail" placeholder="Enter email">
                            </div>
                            <div class="form-group">
                                <label for="clientPhone">Phone Number</label>
                                <input type="tel" class="form-control" id="clientPhone" placeholder="Enter phone number">
                            </div>
                            <div class="form-group">
                                <label for="serviceType">Service Type</label>
                                <select class="form-control" id="serviceType">
                                    <option value="">Select service type</option>
                                    <option value="logo">Logo Design</option>
                                    <option value="branding">Branding Package</option>
                                    <option value="web">Web Design</option>
                                    <option value="social">Social Media Graphics</option>
                                    <option value="print">Print Design</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Engagement Type</label>
                                <div style="display: flex; gap: 20px; margin-top: 10px;">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                        <input type="radio" id="contract" name="engagementType" value="contract" onchange="toggleContractOptions()">
                                        <span>Contract</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                        <input type="radio" id="onetime" name="engagementType" value="onetime" onchange="toggleContractOptions()">
                                        <span>One-Time</span>
                                    </label>
                                </div>
                                <div id="contractOptions" style="display: none; margin-top: 15px;">
                                    <label>Contract Duration</label>
                                    <select class="form-control" id="contractDuration" onchange="togglePaymentTracking()">
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                        <option value="quarterly">Quarterly</option>
                                        <option value="yearly">Yearly</option>
                                    </select>
                                    <div id="paymentTracking" style="display: none; margin-top: 15px;">
                                        <label>Payment Tracking</label>
                                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                                <span><strong>Total Payments Made:</strong></span>
                                                <span id="totalPaymentsCount" style="background: var(--primary); color: white; padding: 4px 12px; border-radius: 20px; font-size: 14px;">0</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                                <span><strong>Total Amount Paid:</strong></span>
                                                <span id="totalAmountPaid" style="color: var(--success); font-weight: bold;">KSh 0</span>
                                            </div>
                                            
                                            <!-- Payment Input Section -->
                                            <div style="margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; border: 1px solid #ddd;">
                                                <label style="font-weight: bold; margin-bottom: 8px; display: block;">Add Payment</label>
                                                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                                    <input type="number" id="manualPaymentAmount" placeholder="Enter amount" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                                    <button type="button" class="btn" style="background: var(--success); color: white; padding: 8px 15px;" onclick="addManualPayment()">
                                                        <i class="fas fa-plus"></i> Add
                                                    </button>
                                                </div>
                                                <div style="display: flex; gap: 10px;">
                                                    <button type="button" class="btn" style="background: var(--primary); color: white; flex: 1;" onclick="addFullPayment()">
                                                        <i class="fas fa-check"></i> Add Full Project Amount
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <!-- Payment History -->
                                            <div id="paymentHistory" style="max-height: 150px; overflow-y: auto;">
                                                <label style="font-weight: bold; margin-bottom: 8px; display: block;">Payment History</label>
                                                <div id="paymentList" style="font-size: 0.9rem;">
                                                    <div style="text-align: center; color: #666; padding: 10px;">No payments recorded</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="projectValue">Project Value</label>
                                <input type="number" class="form-control" id="projectValue" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label for="paymentStatus">Payment Status</label>
                                <select class="form-control" id="paymentStatus" onchange="updateClientStatus()">
                                    <option value="deposit">Deposit (50%)</option>
                                    <option value="fully-paid">Fully Paid</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="clientStatus">Client Status</label>
                                <select class="form-control" id="clientStatus">
                                    <option value="Active">Active</option>
                                    <option value="Paused">Paused</option>
                                    <option value="Closed">Closed</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Client</button>
                        </form>
                    </div>

                </div>

                <!-- Revenue Analytics -->
                <div class="tab-content">
                    <div class="chart-container">
                        <div class="chart-card">
                            <h2 class="card-title mb-20">Revenue by Service Type</h2>
                            <canvas id="revenueChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h2 class="card-title mb-20">Monthly Revenue</h2>
                            <canvas id="monthlyRevenueChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card mt-20">
                        <div class="card-header">
                            <h2 class="card-title">Revenue Summary</h2>
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Service Type</th>
                                        <th>Number of Projects</th>
                                        <th>Total Revenue</th>
                                        <th>Average Project Value</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${renderRevenueSummaryTable()}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Outreach Tracking -->
                <div class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Add New Prospect</h2>
                        </div>
                        <form>
                            <div class="form-group">
                                <label for="prospectName">Prospect Name</label>
                                <input type="text" class="form-control" id="prospectName" placeholder="Enter prospect name">
                            </div>
                            <div class="form-group">
                                <label for="prospectCompany">Company</label>
                                <input type="text" class="form-control" id="prospectCompany" placeholder="Enter company name">
                            </div>
                            <div class="form-group">
                                <label for="prospectEmail">Email Address</label>
                                <input type="email" class="form-control" id="prospectEmail" placeholder="Enter email">
                            </div>
                            <div class="form-group">
                                <label for="prospectPhone">Phone Number</label>
                                <input type="tel" class="form-control" id="prospectPhone" placeholder="Enter phone number">
                            </div>
                            <div class="form-group">
                                <label for="proposedService">Proposed Service</label>
                                <select class="form-control" id="proposedService">
                                    <option value="">Select service type</option>
                                    <option value="logo">Logo Design</option>
                                    <option value="branding">Branding Package</option>
                                    <option value="web">Web Design</option>
                                    <option value="social">Social Media Graphics</option>
                                    <option value="print">Print Design</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Prospect</button>
                        </form>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Prospect Pipeline</h2>
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Prospect</th>
                                        <th>Company</th>
                                        <th>Contact</th>
                                        <th>Proposed Service</th>
                                        <th>Proposal Sent</th>
                                        <th>Response</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${renderProspectTable()}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;

            // Re-initialize dashboard functionality
            initializeTabs();
            initializeForms();
            initializeSearch();
            
            // Add search functionality for dashboard
            const searchInput = document.querySelector('input[placeholder="Search..."]');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const clientRows = document.querySelectorAll('tbody tr');
                    clientRows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(searchTerm) ? '' : 'none';
                    });
                });
            }
        }

        function showClients() {
            const stats = calculateClientStats();
            const mainContent = document.querySelector('.main-content');
            mainContent.innerHTML = `
                <div class="header">
                    <h1 class="page-title">Clients</h1>
                    <div class="d-flex align-center gap-10">
                        <div class="form-group" style="margin-bottom: 0; min-width: 250px;">
                            <input type="text" class="form-control" placeholder="Search clients...">
                        </div>
                        <button class="btn btn-primary" onclick="showAddClientForm()"><i class="fas fa-plus"></i> New Client</button>
                    </div>
                </div>

                <!-- Client Analytics with Tabs -->
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-header">
                        <h3 class="card-title">Client Analytics</h3>
                    </div>
                    <div class="card-body" style="padding: 15px;">
                        <!-- Analytics Tabs -->
                        <div class="tabs" style="margin-bottom: 15px;">
                            <div class="tab active" onclick="switchAnalyticsTab('overview')">Overview</div>
                            <div class="tab" onclick="switchAnalyticsTab('status')">Status</div>
                            <div class="tab" onclick="switchAnalyticsTab('payments')">Payments</div>
                            <div class="tab" onclick="switchAnalyticsTab('contracts')">Contracts</div>
                        </div>
                        
                        <!-- Overview Tab -->
                        <div id="analytics-overview" class="analytics-tab-content">
                            <!-- Horizontal Overview Tabs -->
                            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 200px; text-align: center; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px;">
                                    <h3 style="margin: 0; font-size: 1.8rem;">${stats.totalClients}</h3>
                                    <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9rem;">Total Clients</p>
                                </div>
                                <div style="flex: 1; min-width: 200px; text-align: center; padding: 15px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; border-radius: 8px;">
                                    <h3 style="margin: 0; font-size: 1.8rem;">KSh ${stats.totalRevenue.toLocaleString()}</h3>
                                    <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9rem;">Total Revenue</p>
                                </div>
                            </div>
                            
                            <!-- Additional Metrics Row -->
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 150px; text-align: center; padding: 12px; background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: #333; border-radius: 8px;">
                                    <h4 style="margin: 0; font-size: 1.5rem;">${stats.activeClients}</h4>
                                    <p style="margin: 5px 0 0 0; opacity: 0.8; font-size: 0.85rem;">Active</p>
                                </div>
                                <div style="flex: 1; min-width: 150px; text-align: center; padding: 12px; background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #333; border-radius: 8px;">
                                    <h4 style="margin: 0; font-size: 1.5rem;">${stats.pausedClients}</h4>
                                    <p style="margin: 5px 0 0 0; opacity: 0.8; font-size: 0.85rem;">Paused</p>
                                </div>
                                <div style="flex: 1; min-width: 150px; text-align: center; padding: 12px; background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; border-radius: 8px;">
                                    <h4 style="margin: 0; font-size: 1.5rem;">${stats.closedClients}</h4>
                                    <p style="margin: 5px 0 0 0; opacity: 0.8; font-size: 0.85rem;">Closed</p>
                                </div>
                                <div style="flex: 1; min-width: 150px; text-align: center; padding: 12px; background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%); color: #333; border-radius: 8px;">
                                    <h4 style="margin: 0; font-size: 1.5rem;">KSh ${stats.pendingRevenue.toLocaleString()}</h4>
                                    <p style="margin: 5px 0 0 0; opacity: 0.8; font-size: 0.85rem;">Pending</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Status Tab -->
                        <div id="analytics-status" class="analytics-tab-content" style="display: none;">
                            <div class="row">
                                <div class="col-md-4">
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--success);">
                                        <h4 style="margin: 0 0 10px 0; color: #333;">Client Status</h4>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Active:</span>
                                            <span style="color: var(--success); font-weight: bold;">${stats.activeClients}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Paused:</span>
                                            <span style="color: var(--warning); font-weight: bold;">${stats.pausedClients}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Closed:</span>
                                            <span style="color: var(--gray); font-weight: bold;">${stats.closedClients}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--info);">
                                        <h4 style="margin: 0 0 10px 0; color: #333;">Status Distribution</h4>
                                        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                                            <div style="text-align: center; padding: 10px; background: white; border-radius: 6px; flex: 1; min-width: 120px;">
                                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--success);">${stats.activeClients}</div>
                                                <div style="font-size: 0.9rem; color: #666;">Active</div>
                                            </div>
                                            <div style="text-align: center; padding: 10px; background: white; border-radius: 6px; flex: 1; min-width: 120px;">
                                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--warning);">${stats.pausedClients}</div>
                                                <div style="font-size: 0.9rem; color: #666;">Paused</div>
                                            </div>
                                            <div style="text-align: center; padding: 10px; background: white; border-radius: 6px; flex: 1; min-width: 120px;">
                                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--gray);">${stats.closedClients}</div>
                                                <div style="font-size: 0.9rem; color: #666;">Closed</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Payments Tab -->
                        <div id="analytics-payments" class="analytics-tab-content" style="display: none;">
                            <div class="row">
                                <div class="col-md-6">
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                                        <h4 style="margin: 0 0 10px 0; color: #333;">Payment Status</h4>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Fully Paid:</span>
                                            <span style="color: var(--success); font-weight: bold;">${stats.paymentStatus.fullyPaid}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Deposit Only:</span>
                                            <span style="color: var(--warning); font-weight: bold;">${stats.paymentStatus.deposit}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Pending Revenue:</span>
                                            <span style="color: var(--primary); font-weight: bold;">KSh ${stats.pendingRevenue.toLocaleString()}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--success);">
                                        <h4 style="margin: 0 0 10px 0; color: #333;">Revenue Summary</h4>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Total Revenue:</span>
                                            <span style="color: var(--success); font-weight: bold;">KSh ${stats.totalRevenue.toLocaleString()}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Total Project Value:</span>
                                            <span style="color: var(--info); font-weight: bold;">KSh ${stats.totalProjectValue.toLocaleString()}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Completion Rate:</span>
                                            <span style="color: var(--primary); font-weight: bold;">${stats.totalProjectValue > 0 ? Math.round((stats.totalRevenue / stats.totalProjectValue) * 100) : 0}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contracts Tab -->
                        <div id="analytics-contracts" class="analytics-tab-content" style="display: none;">
                            <div class="row">
                                <div class="col-md-6">
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--info);">
                                        <h4 style="margin: 0 0 10px 0; color: #333;">Contract Types</h4>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Weekly:</span>
                                            <span style="color: var(--primary); font-weight: bold;">${stats.contractTypes.weekly}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Monthly:</span>
                                            <span style="color: var(--success); font-weight: bold;">${stats.contractTypes.monthly}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Quarterly:</span>
                                            <span style="color: var(--warning); font-weight: bold;">${stats.contractTypes.quarterly}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Yearly:</span>
                                            <span style="color: var(--danger); font-weight: bold;">${stats.contractTypes.yearly}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--success);">
                                        <h4 style="margin: 0 0 10px 0; color: #333;">Contract Distribution</h4>
                                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                                            <div style="text-align: center; padding: 10px; background: white; border-radius: 6px; flex: 1; min-width: 80px;">
                                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">${stats.contractTypes.weekly}</div>
                                                <div style="font-size: 0.8rem; color: #666;">Weekly</div>
                                            </div>
                                            <div style="text-align: center; padding: 10px; background: white; border-radius: 6px; flex: 1; min-width: 80px;">
                                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--success);">${stats.contractTypes.monthly}</div>
                                                <div style="font-size: 0.8rem; color: #666;">Monthly</div>
                                            </div>
                                            <div style="text-align: center; padding: 10px; background: white; border-radius: 6px; flex: 1; min-width: 80px;">
                                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--warning);">${stats.contractTypes.quarterly}</div>
                                                <div style="font-size: 0.8rem; color: #666;">Quarterly</div>
                                            </div>
                                            <div style="text-align: center; padding: 10px; background: white; border-radius: 6px; flex: 1; min-width: 80px;">
                                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--danger);">${stats.contractTypes.yearly}</div>
                                                <div style="font-size: 0.8rem; color: #666;">Yearly</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Current Clients</h2>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Client</th>
                                    <th>Service</th>
                                    <th>Type</th>
                                    <th>Value</th>
                                    <th>Payment Status</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${renderClientTable()}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // Add search functionality for clients
            const searchInput = document.querySelector('input[placeholder="Search clients..."]');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const clientRows = document.querySelectorAll('tbody tr');
                    clientRows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(searchTerm) ? '' : 'none';
                    });
                });
            }
        }

        function showAddClientForm() {
            const mainContent = document.querySelector('.main-content');
            mainContent.innerHTML = `
                <div class="header">
                    <h1 class="page-title">Add New Client</h1>
                    <button class="btn" onclick="showClients()" style="background: var(--gray); color: white;"><i class="fas fa-arrow-left"></i> Back to Clients</button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Client Details</h2>
                    </div>
                    <form id="clientForm">
                        <div class="form-group">
                            <label for="clientName">Client Name</label>
                            <input type="text" class="form-control" id="clientName" placeholder="Enter client name">
                        </div>
                        <div class="form-group">
                            <label for="clientEmail">Email Address</label>
                            <input type="email" class="form-control" id="clientEmail" placeholder="Enter email">
                        </div>
                        <div class="form-group">
                            <label for="clientPhone">Phone Number</label>
                            <input type="tel" class="form-control" id="clientPhone" placeholder="Enter phone number">
                        </div>
                        <div class="form-group">
                            <label for="serviceType">Service Type</label>
                            <select class="form-control" id="serviceType">
                                <option value="">Select service type</option>
                                <option value="logo">Logo Design</option>
                                <option value="branding">Branding Package</option>
                                <option value="web">Web Design</option>
                                <option value="social">Social Media Graphics</option>
                                <option value="print">Print Design</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Engagement Type</label>
                            <div style="display: flex; gap: 20px; margin-top: 10px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="radio" id="contract" name="engagementType" value="contract" onchange="toggleContractOptions()">
                                    <span>Contract</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="radio" id="onetime" name="engagementType" value="onetime" onchange="toggleContractOptions()">
                                    <span>One-Time</span>
                                </label>
                            </div>
                            <div id="contractOptions" style="display: none; margin-top: 15px;">
                                <label>Contract Duration</label>
                                <select class="form-control" id="contractDuration" onchange="togglePaymentTracking()">
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="yearly">Yearly</option>
                                </select>
                                <div id="paymentTracking" style="display: none; margin-top: 15px;">
                                    <label>Payment Tracking</label>
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                            <span><strong>Total Payments Made:</strong></span>
                                            <span id="totalPaymentsCount" style="background: var(--primary); color: white; padding: 4px 12px; border-radius: 20px; font-size: 14px;">0</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                            <span><strong>Total Amount Paid:</strong></span>
                                            <span id="totalAmountPaid" style="color: var(--success); font-weight: bold;">KSh 0</span>
                                        </div>
                                        
                                        <!-- Payment Input Section -->
                                        <div style="margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; border: 1px solid #ddd;">
                                            <label style="font-weight: bold; margin-bottom: 8px; display: block;">Add Payment</label>
                                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                                <input type="number" id="manualPaymentAmount" placeholder="Enter amount" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                                <button type="button" class="btn" style="background: var(--success); color: white; padding: 8px 15px;" onclick="addManualPayment()">
                                                    <i class="fas fa-plus"></i> Add
                                                </button>
                                            </div>
                                            <div style="display: flex; gap: 10px;">
                                                <button type="button" class="btn" style="background: var(--primary); color: white; flex: 1;" onclick="addFullPayment()">
                                                    <i class="fas fa-check"></i> Add Full Project Amount
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- Payment History -->
                                        <div id="paymentHistory" style="max-height: 150px; overflow-y: auto;">
                                            <label style="font-weight: bold; margin-bottom: 8px; display: block;">Payment History</label>
                                            <div id="paymentList" style="font-size: 0.9rem;">
                                                <div style="text-align: center; color: #666; padding: 10px;">No payments recorded</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="projectValue">Project Value</label>
                            <input type="number" class="form-control" id="projectValue" placeholder="Enter amount">
                        </div>
                        <div class="form-group">
                            <label for="paymentStatus">Payment Status</label>
                            <select class="form-control" id="paymentStatus" onchange="updateClientStatus()">
                                <option value="deposit">Deposit (50%)</option>
                                <option value="fully-paid">Fully Paid</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="clientStatus">Client Status</label>
                            <select class="form-control" id="clientStatus">
                                <option value="Active">Active</option>
                                <option value="Paused">Paused</option>
                                <option value="Closed">Closed</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Client</button>
                    </form>
                </div>
            `;

            // Initialize form functionality
            initializeForms();
        }

        function showAnalytics() {
            const mainContent = document.querySelector('.main-content');
            mainContent.innerHTML = `
                <div class="header">
                    <h1 class="page-title">Analytics</h1>
                </div>

                <div class="chart-container">
                    <div class="chart-card">
                        <h2 class="card-title mb-20">Revenue by Service Type</h2>
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h2 class="card-title mb-20">Monthly Revenue</h2>
                        <canvas id="monthlyRevenueChart"></canvas>
                    </div>
                </div>
                
                <div class="card mt-20">
                    <div class="card-header">
                        <h2 class="card-title">Revenue Summary</h2>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Service Type</th>
                                    <th>Number of Projects</th>
                                    <th>Total Revenue</th>
                                    <th>Average Project Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Logo Design</td>
                                    <td>12</td>
                                    <td>KSh 9,600</td>
                                    <td>KSh 800</td>
                                </tr>
                                <tr>
                                    <td>Branding Package</td>
                                    <td>8</td>
                                    <td>KSh 28,500</td>
                                    <td>KSh 3,562</td>
                                </tr>
                                <tr>
                                    <td>Web Design</td>
                                    <td>5</td>
                                    <td>KSh 31,200</td>
                                    <td>KSh 6,240</td>
                                </tr>
                                <tr>
                                    <td>Social Media Graphics</td>
                                    <td>15</td>
                                    <td>KSh 12,000</td>
                                    <td>KSh 800</td>
                                </tr>
                                <tr>
                                    <td>Print Design</td>
                                    <td>7</td>
                                    <td>KSh 8,400</td>
                                    <td>KSh 1,200</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // Render charts
            renderCharts();
        }

        function showOutreach() {
            const mainContent = document.querySelector('.main-content');
            mainContent.innerHTML = `
                <div class="header">
                    <h1 class="page-title">Outreach</h1>
                    <div class="d-flex align-center gap-10">
                        <div class="form-group" style="margin-bottom: 0; min-width: 250px;">
                            <input type="text" class="form-control" placeholder="Search prospects..." id="prospectSearch">
                        </div>
                        <button class="btn btn-primary" onclick="showAddProspectForm()"><i class="fas fa-plus"></i> New Prospect</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Prospect Pipeline</h2>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Prospect</th>
                                    <th>Company</th>
                                    <th>Contact</th>
                                    <th>Proposed Service</th>
                                    <th>Proposal Sent</th>
                                    <th>Response</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${renderProspectTable()}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // Initialize search functionality
            const searchInput = document.getElementById('prospectSearch');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    filterProspectTable(searchTerm);
                });
            }
        }

        // Tab functionality
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.textContent.trim();
                    
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    // Show corresponding content
                    if (target === 'Client Management') {
                        document.querySelectorAll('.tab-content')[0].classList.add('active');
                    } else if (target === 'Revenue Analytics') {
                        document.querySelectorAll('.tab-content')[1].classList.add('active');
                        renderCharts();
                    } else if (target === 'Outreach Tracking') {
                        document.querySelectorAll('.tab-content')[2].classList.add('active');
                    }
                });
            });
        }

        // Form functionality
        function initializeForms() {
            // Client form
            const clientForm = document.querySelector('form');
            if (clientForm) {
                clientForm.addEventListener('submit', handleClientSubmit);
            }

            // Prospect form
            const prospectForm = document.querySelectorAll('form')[1];
            if (prospectForm) {
                prospectForm.addEventListener('submit', handleProspectSubmit);
            }

            // New Client button
            const newClientBtn = document.querySelector('.btn-primary');
            if (newClientBtn && newClientBtn.textContent.includes('New Client')) {
                newClientBtn.addEventListener('click', () => {
                    // Switch to client management tab
                    document.querySelectorAll('.tab')[0].click();
                    // Scroll to form
                    document.querySelector('form').scrollIntoView({ behavior: 'smooth' });
                });
            }
        }

        function handleClientSubmit(e) {
            e.preventDefault();
            
            const projectValue = parseFloat(document.getElementById('projectValue').value) || 0;
            const paymentStatus = document.getElementById('paymentStatus').value;
            const engagementType = document.querySelector('input[name="engagementType"]:checked')?.value || '';
            const clientStatus = document.getElementById('clientStatus').value;
            
            const clientData = {
                id: Date.now(),
                name: document.getElementById('clientName').value,
                email: document.getElementById('clientEmail').value,
                phone: document.getElementById('clientPhone').value,
                service: document.getElementById('serviceType').value,
                type: engagementType,
                contractDuration: engagementType === 'contract' ? document.getElementById('contractDuration').value : null,
                value: projectValue,
                paymentStatus: paymentStatus,
                paidAmount: paymentStatus === 'fully-paid' ? projectValue : Math.floor(projectValue * 0.5),
                status: clientStatus,
                monthlyPayments: []
            };

            // Validate form
            if (!clientData.name || !clientData.email || !clientData.service || !clientData.type) {
                alert('Please fill in all required fields');
                return;
            }

            // Add client
            clients.push(clientData);
            saveData();
            
            // Clear form
            e.target.reset();
            
            // Update UI - always go back to clients list
            showClients();
            updateStats();
            
            // Show success message
            showNotification('Client added successfully!', 'success');
        }

        function handleProspectSubmit(e) {
            e.preventDefault();
            
            const prospectData = {
                id: Date.now(),
                name: document.getElementById('prospectName').value,
                company: document.getElementById('prospectCompany').value,
                email: document.getElementById('prospectEmail').value,
                phone: document.getElementById('prospectPhone').value,
                service: document.getElementById('proposedService').value,
                proposalSent: document.getElementById('proposalSent').value || new Date().toISOString().split('T')[0],
                response: document.getElementById('prospectResponse').value,
                status: document.getElementById('prospectStatus').value
            };

            // Validate form
            if (!prospectData.name || !prospectData.email || !prospectData.service) {
                alert('Please fill in all required fields');
                return;
            }

            // Add prospect
            prospects.push(prospectData);
            saveData();
            
            // Clear form
            e.target.reset();
            
            // Update UI - go back to outreach page
            showOutreach();
            updateStats();
            
            // Show success message
            showNotification('Prospect added successfully!', 'success');
        }

        // Search functionality
        function initializeSearch() {
            const searchInput = document.querySelector('input[placeholder="Search..."]');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    filterTables(searchTerm);
                });
            }
        }

        function filterTables(searchTerm) {
            // Filter client table
            const clientRows = document.querySelectorAll('tbody tr');
            clientRows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterProspectTable(searchTerm) {
            // Filter prospect table
            const prospectRows = document.querySelectorAll('tbody tr');
            prospectRows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Table rendering and actions
        function renderClientTable() {
            if (!clients || clients.length === 0) return '';

            return clients.map(client => `
                <tr>
                    <td>
                        <div>
                            <strong>${client.name || 'N/A'}</strong>
                            <br><small style="color: #666;">${client.email || 'N/A'}</small>
                            <br><small style="color: #666;">${client.phone || 'N/A'}</small>
                        </div>
                    </td>
                    <td>${client.service || 'N/A'}</td>
                    <td>
                        ${client.type || 'N/A'}
                        ${client.contractDuration ? `<br><small style="color: #666;">${client.contractDuration}</small>` : ''}
                    </td>
                    <td>KSh ${(client.value || 0).toLocaleString()}</td>
                    <td class="${client.paymentStatus === 'fully-paid' ? 'text-success' : 'text-warning'}">
                        ${client.paymentStatus === 'fully-paid' ? 'Fully Paid' : 'Deposit (50%)'}
                        <br><small>KSh ${(client.paidAmount || 0).toLocaleString()} paid</small>
                        ${client.monthlyPayments && client.monthlyPayments.length > 0 ? `<br><small style="color: #666;">${client.monthlyPayments.length} payments</small>` : ''}
                    </td>
                    <td><span class="status-badge status-${(client.status || 'Active').toLowerCase().replace(' ', '-')}">${client.status || 'Active'}</span></td>
                    <td>
                        <i class="fas fa-edit" style="color: var(--primary); cursor: pointer;" onclick="editClient(${client.id})"></i>
                        <i class="fas fa-trash" style="color: var(--danger); cursor: pointer; margin-left: 10px;" onclick="deleteClient(${client.id})"></i>
                    </td>
                </tr>
            `).join('');
        }

        function renderProspectTable() {
            if (!prospects || prospects.length === 0) return '';

            return prospects.map(prospect => `
                <tr>
                    <td>
                        <div>
                            <strong>${prospect.name || 'N/A'}</strong>
                            <br><small style="color: #666;">${prospect.phone || 'N/A'}</small>
                        </div>
                    </td>
                    <td>${prospect.company || 'N/A'}</td>
                    <td>${prospect.email || 'N/A'}</td>
                    <td>${prospect.service || 'N/A'}</td>
                    <td>${prospect.proposalSent || 'N/A'}</td>
                    <td>${prospect.response || 'N/A'}</td>
                    <td><span class="status-badge status-${(prospect.status || 'Awaiting Response').toLowerCase().replace(' ', '-')}">${prospect.status || 'Awaiting Response'}</span></td>
                    <td>
                        <i class="fas fa-edit" style="color: var(--primary); cursor: pointer;" onclick="editProspect(${prospect.id})"></i>
                        <i class="fas fa-trash" style="color: var(--danger); cursor: pointer; margin-left: 10px;" onclick="deleteProspect(${prospect.id})"></i>
                    </td>
                </tr>
            `).join('');
        }


        // Client actions
        function editClient(id) {
            const client = clients.find(c => c.id === id);
            if (!client) return;

            // Set current editing client for payment tracking
            window.currentEditingClient = client;
            
            // Show the add client form in edit mode
            showAddClientForm();
            
            // Wait for DOM to update, then fill form
            setTimeout(() => {
                fillClientForm(client, id);
            }, 100);
        }

        function fillClientForm(client, id) {
            // Update page title to show editing
            const pageTitle = document.querySelector('.page-title');
            if (pageTitle) {
                pageTitle.textContent = 'Edit Client';
            }

            // Fill form with client data
            const nameField = document.getElementById('clientName');
            const emailField = document.getElementById('clientEmail');
            const phoneField = document.getElementById('clientPhone');
            const serviceField = document.getElementById('serviceType');
            const valueField = document.getElementById('projectValue');
            const paymentStatusField = document.getElementById('paymentStatus');
            const clientStatusField = document.getElementById('clientStatus');
            const contractDurationField = document.getElementById('contractDuration');
            
            if (nameField) nameField.value = client.name || '';
            if (emailField) emailField.value = client.email || '';
            if (phoneField) phoneField.value = client.phone || '';
            if (serviceField) serviceField.value = client.service || '';
            if (valueField) valueField.value = client.value || '';
            if (paymentStatusField) paymentStatusField.value = client.paymentStatus || 'deposit';
            if (clientStatusField) clientStatusField.value = client.status || 'Active';
            if (contractDurationField && client.contractDuration) contractDurationField.value = client.contractDuration;
            
            // Handle radio buttons
            const contractRadio = document.querySelector('input[name="engagementType"][value="contract"]');
            const onetimeRadio = document.querySelector('input[name="engagementType"][value="onetime"]');
            
            if (contractRadio && onetimeRadio) {
                if (client.type === 'Contract') {
                    contractRadio.checked = true;
                } else if (client.type === 'One-Time') {
                    onetimeRadio.checked = true;
                }
            }

            // Toggle contract options based on engagement type
            toggleContractOptions();
            togglePaymentTracking();

            // Update payment tracking display
            updatePaymentTrackingDisplay();
            updatePaymentHistory();

            // Scroll to form
            const form = document.querySelector('form');
            if (form) {
                form.scrollIntoView({ behavior: 'smooth' });
            }

            // Update form to edit mode
            const submitBtn = document.querySelector('form button[type="submit"]');
            if (submitBtn) {
                submitBtn.textContent = 'Update Client';
                submitBtn.onclick = (e) => {
                    e.preventDefault();
                    updateClient(id);
                };
            }
        }

        function updateClient(id) {
            const clientIndex = clients.findIndex(c => c.id === id);
            if (clientIndex === -1) return;

            const nameField = document.getElementById('clientName');
            const emailField = document.getElementById('clientEmail');
            const phoneField = document.getElementById('clientPhone');
            const serviceField = document.getElementById('serviceType');
            const valueField = document.getElementById('projectValue');
            const paymentStatusField = document.getElementById('paymentStatus');
            const clientStatusField = document.getElementById('clientStatus');
            const engagementType = document.querySelector('input[name="engagementType"]:checked');
            const contractDurationField = document.getElementById('contractDuration');

            const projectValue = valueField ? parseFloat(valueField.value) || 0 : 0;
            const newPaymentStatus = paymentStatusField ? paymentStatusField.value : 'deposit';
            const newClientStatus = clientStatusField ? clientStatusField.value : 'Active';
            const engagementTypeValue = engagementType ? engagementType.value : '';

            // Calculate new paid amount based on payment status
            let newPaidAmount;
            if (newPaymentStatus === 'fully-paid') {
                newPaidAmount = projectValue;
            } else {
                newPaidAmount = Math.floor(projectValue * 0.5);
            }

            clients[clientIndex] = {
                ...clients[clientIndex],
                name: nameField ? nameField.value : '',
                email: emailField ? emailField.value : '',
                phone: phoneField ? phoneField.value : '',
                service: serviceField ? serviceField.value : '',
                type: engagementTypeValue,
                contractDuration: engagementTypeValue === 'contract' && contractDurationField ? contractDurationField.value : null,
                value: projectValue,
                paymentStatus: newPaymentStatus,
                paidAmount: newPaidAmount,
                status: newClientStatus
            };

            saveData();
            
            // Clear current editing client
            window.currentEditingClient = null;
            
            // Go back to clients list
            showClients();
            updateStats();
            
            showNotification('Client updated successfully!', 'success');
        }

        function deleteClient(id) {
            if (confirm('Are you sure you want to delete this client?')) {
                clients = clients.filter(c => c.id !== id);
                saveData();
                
                // Go back to clients list
                showClients();
                updateStats();
                showNotification('Client deleted successfully!', 'success');
            }
        }

        // Show add prospect form
        function showAddProspectForm() {
            const mainContent = document.querySelector('.main-content');
            mainContent.innerHTML = `
                <div class="header">
                    <h1 class="page-title">Add New Prospect</h1>
                    <button class="btn" onclick="showOutreach()" style="background: var(--gray); color: white;"><i class="fas fa-arrow-left"></i> Back to Outreach</button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Prospect Details</h2>
                    </div>
                    <form>
                        <div class="form-group">
                            <label for="prospectName">Prospect Name</label>
                            <input type="text" class="form-control" id="prospectName" placeholder="Enter prospect name">
                        </div>
                        <div class="form-group">
                            <label for="prospectCompany">Company</label>
                            <input type="text" class="form-control" id="prospectCompany" placeholder="Enter company name">
                        </div>
                        <div class="form-group">
                            <label for="prospectEmail">Email Address</label>
                            <input type="email" class="form-control" id="prospectEmail" placeholder="Enter email">
                        </div>
                        <div class="form-group">
                            <label for="prospectPhone">Phone Number</label>
                            <input type="tel" class="form-control" id="prospectPhone" placeholder="Enter phone number">
                        </div>
                        <div class="form-group">
                            <label for="proposedService">Proposed Service</label>
                            <select class="form-control" id="proposedService">
                                <option value="">Select service type</option>
                                <option value="logo">Logo Design</option>
                                <option value="branding">Branding Package</option>
                                <option value="web">Web Design</option>
                                <option value="social">Social Media Graphics</option>
                                <option value="print">Print Design</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="proposalSent">Proposal Sent Date</label>
                            <input type="date" class="form-control" id="proposalSent">
                        </div>
                        <div class="form-group">
                            <label for="prospectResponse">Response</label>
                            <select class="form-control" id="prospectResponse">
                                <option value="No Response">No Response</option>
                                <option value="Interested">Interested</option>
                                <option value="Not Interested">Not Interested</option>
                                <option value="Follow Up Required">Follow Up Required</option>
                                <option value="Meeting Scheduled">Meeting Scheduled</option>
                                <option value="Proposal Under Review">Proposal Under Review</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="prospectStatus">Status</label>
                            <select class="form-control" id="prospectStatus">
                                <option value="Awaiting Response">Awaiting Response</option>
                                <option value="In Discussion">In Discussion</option>
                                <option value="Proposal Sent">Proposal Sent</option>
                                <option value="Negotiating">Negotiating</option>
                                <option value="Converted">Converted</option>
                                <option value="Lost">Lost</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Prospect</button>
                    </form>
                </div>
            `;

            // Set default values for new prospects
            document.getElementById('proposalSent').value = new Date().toISOString().split('T')[0];
            document.getElementById('prospectResponse').value = 'No Response';
            document.getElementById('prospectStatus').value = 'Awaiting Response';

            // Handle form submission for new prospects
            const form = document.querySelector('form');
            if (form) {
                form.addEventListener('submit', handleProspectSubmit);
            }
        }

        // Prospect actions
        function editProspect(id) {
            const prospect = prospects.find(p => p.id === id);
            if (!prospect) return;

            // Set current editing prospect
            window.currentEditingProspect = prospect;
            
            // Show the add prospect form in edit mode
            showAddProspectForm();
            
            // Wait for DOM to update, then fill form
            setTimeout(() => {
                fillProspectForm(prospect, id);
            }, 100);
        }

        function fillProspectForm(prospect, id) {
            // Update page title to show editing
            const pageTitle = document.querySelector('.page-title');
            if (pageTitle) {
                pageTitle.textContent = 'Edit Prospect';
            }

            // Fill form with prospect data
            document.getElementById('prospectName').value = prospect.name || '';
            document.getElementById('prospectCompany').value = prospect.company || '';
            document.getElementById('prospectEmail').value = prospect.email || '';
            document.getElementById('prospectPhone').value = prospect.phone || '';
            document.getElementById('proposedService').value = prospect.service || '';
            document.getElementById('proposalSent').value = prospect.proposalSent || '';
            document.getElementById('prospectResponse').value = prospect.response || 'No Response';
            document.getElementById('prospectStatus').value = prospect.status || 'Awaiting Response';

            // Update form to edit mode
            const submitBtn = document.querySelector('form button[type="submit"]');
            if (submitBtn) {
                submitBtn.textContent = 'Update Prospect';
            }
            
            // Remove existing event listener and add new one
            const form = document.querySelector('form');
            if (form) {
                form.removeEventListener('submit', handleProspectSubmit);
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    updateProspect(id);
                });
            }
        }

        function updateProspect(id) {
            const prospectIndex = prospects.findIndex(p => p.id === id);
            if (prospectIndex === -1) return;

            prospects[prospectIndex] = {
                ...prospects[prospectIndex],
                name: document.getElementById('prospectName').value,
                company: document.getElementById('prospectCompany').value,
                email: document.getElementById('prospectEmail').value,
                phone: document.getElementById('prospectPhone').value,
                service: document.getElementById('proposedService').value,
                proposalSent: document.getElementById('proposalSent').value,
                response: document.getElementById('prospectResponse').value,
                status: document.getElementById('prospectStatus').value
            };

            saveData();
            
            // Clear current editing prospect
            window.currentEditingProspect = null;
            
            // Go back to outreach page
            showOutreach();
            updateStats();
            
            showNotification('Prospect updated successfully!', 'success');
        }

        function deleteProspect(id) {
            if (confirm('Are you sure you want to delete this prospect?')) {
                prospects = prospects.filter(p => p.id !== id);
                saveData();
                
                // Go back to outreach page
                showOutreach();
                updateStats();
                showNotification('Prospect deleted successfully!', 'success');
            }
        }

        // Calculate comprehensive client statistics
        function calculateClientStats() {
            const contractClients = clients.filter(c => c.type === 'Contract');
            
            const stats = {
                totalClients: clients.length,
                activeClients: clients.filter(c => c.status === 'Active').length,
                pausedClients: clients.filter(c => c.status === 'Paused').length,
                closedClients: clients.filter(c => c.status === 'Closed').length,
                contractClients: contractClients.length,
                oneTimeClients: clients.filter(c => c.type === 'One-Time').length,
                totalRevenue: clients.reduce((sum, client) => sum + (client.paidAmount || 0), 0),
                totalProjectValue: clients.reduce((sum, client) => sum + (client.value || 0), 0),
                pendingRevenue: 0,
                contractTypes: {
                    weekly: clients.filter(c => c.contractDuration === 'weekly').length,
                    monthly: clients.filter(c => c.contractDuration === 'monthly').length,
                    quarterly: clients.filter(c => c.contractDuration === 'quarterly').length,
                    yearly: clients.filter(c => c.contractDuration === 'yearly').length
                },
                paymentStatus: {
                    fullyPaid: clients.filter(c => c.paymentStatus === 'fully-paid').length,
                    deposit: clients.filter(c => c.paymentStatus === 'deposit').length
                }
            };

            // Calculate pending revenue (total project value - paid amount)
            stats.pendingRevenue = stats.totalProjectValue - stats.totalRevenue;

            return stats;
        }

        // Stats update
        function updateStats() {
            const totalRevenue = clients.reduce((sum, client) => sum + (client.paidAmount || 0), 0);
            const activeClients = clients.filter(c => c.status === 'Active').length;
            const ongoingProjects = clients.filter(c => c.status === 'Active' || c.status === 'Paused').length;
            const pendingProposals = prospects.filter(p => p.status === 'Awaiting Response').length;

            // Update stat cards
            const statCards = document.querySelectorAll('.stat-info h3');
            if (statCards[0]) statCards[0].textContent = `KSh ${totalRevenue.toLocaleString()}`;
            if (statCards[1]) statCards[1].textContent = activeClients;
            if (statCards[2]) statCards[2].textContent = ongoingProjects;
            if (statCards[3]) statCards[3].textContent = pendingProposals;
        }

        // Charts
        function renderCharts() {
            // Destroy existing charts if they exist
            if (window.revenueChart) window.revenueChart.destroy();
            if (window.monthlyChart) window.monthlyChart.destroy();

            // Calculate revenue by service type using the proper function
            const revenueByService = calculateRevenueByService();
            const monthlyRevenue = calculateMonthlyRevenue();

            // Revenue by service type chart
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                const labels = Object.keys(revenueByService);
                const data = Object.values(revenueByService).map(service => service.revenueCollected);
                const colors = [
                    '#6C63FF', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', 
                    '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'
                ];
                
                window.revenueChart = new Chart(revenueCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: colors.slice(0, labels.length),
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                        return `${label}: KSh ${value.toLocaleString()} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Monthly revenue chart
            const monthlyCtx = document.getElementById('monthlyRevenueChart');
            if (monthlyCtx) {
                const labels = Object.keys(monthlyRevenue);
                const data = Object.values(monthlyRevenue);
                
                window.monthlyChart = new Chart(monthlyCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Monthly Revenue (KSh)',
                            data: data,
                            backgroundColor: 'rgba(108, 99, 255, 0.8)',
                            borderColor: 'rgba(108, 99, 255, 1)',
                            borderWidth: 2,
                            borderRadius: 4,
                            borderSkipped: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'KSh ' + value.toLocaleString();
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return 'Revenue: KSh ' + context.parsed.y.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // Projects page
        function showProjectsPage() {
            const mainContent = document.querySelector('.main-content');
            mainContent.innerHTML = `
                <div class="header">
                    <h1 class="page-title">Projects</h1>
                    <div class="d-flex align-center gap-10">
                        <div class="form-group" style="margin-bottom: 0; min-width: 250px;">
                            <input type="text" class="form-control" placeholder="Search projects..." id="projectSearch">
                        </div>
                        <button class="btn btn-primary" onclick="showAddProjectForm()"><i class="fas fa-plus"></i> New Project</button>
                    </div>
                </div>

                <!-- Project Stats -->
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(108, 99, 255, 0.1); color: var(--primary);">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalProjects">${projects.length}</h3>
                            <p>Total Projects</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(78, 205, 196, 0.1); color: var(--secondary);">
                            <i class="fas fa-play"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="inProgressProjects">${projects.filter(p => p.status === 'In Progress').length}</h3>
                            <p>In Progress</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(40, 167, 69, 0.1); color: var(--success);">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="completedProjects">${projects.filter(p => p.status === 'Completed').length}</h3>
                            <p>Completed</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(255, 193, 7, 0.1); color: var(--warning);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="notStartedProjects">${projects.filter(p => p.status === 'Not Started').length}</h3>
                            <p>Not Started</p>
                        </div>
                    </div>
                </div>

                <!-- Projects Table -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">All Projects</h2>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Project Name</th>
                                    <th>Client</th>
                                    <th>Service</th>
                                    <th>Status</th>
                                    <th>Progress</th>
                                    <th>Due Date</th>
                                    <th>Value</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="projectsTableBody">
                                ${renderProjectsTable()}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // Add search functionality
            const searchInput = document.getElementById('projectSearch');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    filterProjects(e.target.value.toLowerCase());
                });
            }
        }

        function renderProjectsTable() {
            if (!projects || projects.length === 0) return '';

            return projects.map(project => `
                <tr>
                    <td>
                        <div>
                            <strong>${project.projectName || 'N/A'}</strong>
                            <br><small style="color: var(--gray);">${project.description || 'No description'}</small>
                        </div>
                    </td>
                    <td>${project.clientName || 'N/A'}</td>
                    <td>${project.service || 'N/A'}</td>
                    <td><span class="status-badge status-${(project.status || 'Not Started').toLowerCase().replace(' ', '-')}">${project.status || 'Not Started'}</span></td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="flex: 1; background: var(--light-gray); height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="width: ${project.progress || 0}%; background: ${getProgressColor(project.progress || 0)}; height: 100%; transition: width 0.3s;"></div>
                            </div>
                            <span style="font-size: 12px; color: var(--gray);">${project.progress || 0}%</span>
                        </div>
                    </td>
                    <td>${project.dueDate || 'N/A'}</td>
                    <td>KSh ${(project.value || 0).toLocaleString()}</td>
                    <td>
                        <i class="fas fa-edit" style="color: var(--primary); cursor: pointer;" onclick="editProject(${project.id})" title="Edit Project"></i>
                        <i class="fas fa-trash" style="color: var(--danger); cursor: pointer; margin-left: 10px;" onclick="deleteProject(${project.id})" title="Delete Project"></i>
                    </td>
                </tr>
            `).join('');
        }

        function getProgressColor(progress) {
            if (progress === 100) return 'var(--success)';
            if (progress >= 50) return 'var(--primary)';
            if (progress > 0) return 'var(--warning)';
            return 'var(--gray)';
        }

        function filterProjects(searchTerm) {
            const rows = document.querySelectorAll('#projectsTableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function showAddProjectForm() {
            const mainContent = document.querySelector('.main-content');
            mainContent.innerHTML = `
                <div class="header">
                    <h1 class="page-title">Add New Project</h1>
                    <button class="btn" onclick="showProjectsPage()" style="background: var(--gray); color: white;"><i class="fas fa-arrow-left"></i> Back to Projects</button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Project Details</h2>
                    </div>
                    <form id="projectForm">
                        <div class="form-group">
                            <label for="projectName">Project Name</label>
                            <input type="text" class="form-control" id="projectName" placeholder="Enter project name" required>
                        </div>
                        <div class="form-group">
                            <label for="projectClient">Client</label>
                            <select class="form-control" id="projectClient" required>
                                <option value="">Select a client</option>
                                ${clients.map(client => `<option value="${client.id}">${client.name}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="projectService">Service Type</label>
                            <select class="form-control" id="projectService" required>
                                <option value="">Select service type</option>
                                <option value="Logo Design">Logo Design</option>
                                <option value="Branding Package">Branding Package</option>
                                <option value="Web Design">Web Design</option>
                                <option value="Social Media Graphics">Social Media Graphics</option>
                                <option value="Print Design">Print Design</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="projectDescription">Description</label>
                            <textarea class="form-control" id="projectDescription" rows="3" placeholder="Enter project description"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="projectValue">Project Value</label>
                            <input type="number" class="form-control" id="projectValue" placeholder="Enter project value" required>
                        </div>
                        <div class="form-group">
                            <label for="projectStartDate">Start Date</label>
                            <input type="date" class="form-control" id="projectStartDate" required>
                        </div>
                        <div class="form-group">
                            <label for="projectDueDate">Due Date</label>
                            <input type="date" class="form-control" id="projectDueDate" required>
                        </div>
                        <div class="form-group">
                            <label for="projectStatus">Status</label>
                            <select class="form-control" id="projectStatus" required>
                                <option value="Not Started">Not Started</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="projectProgress">Progress (%)</label>
                            <input type="range" class="form-control" id="projectProgress" min="0" max="100" value="0" oninput="document.getElementById('progressValue').textContent = this.value + '%'">
                            <span id="progressValue">0%</span>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Project</button>
                    </form>
                </div>
            `;

            // Set default start date to today
            document.getElementById('projectStartDate').value = new Date().toISOString().split('T')[0];

            // Handle form submission for new projects
            document.getElementById('projectForm').addEventListener('submit', handleProjectSubmit);
        }

        function handleProjectSubmit(e) {
            e.preventDefault();
            
            const selectedClientId = parseInt(document.getElementById('projectClient').value);
            const selectedClient = clients.find(c => c.id === selectedClientId);
            
            const projectData = {
                id: Date.now(),
                clientId: selectedClientId,
                clientName: selectedClient ? selectedClient.name : 'Unknown Client',
                projectName: document.getElementById('projectName').value,
                service: document.getElementById('projectService').value,
                status: document.getElementById('projectStatus').value,
                startDate: document.getElementById('projectStartDate').value,
                dueDate: document.getElementById('projectDueDate').value,
                progress: parseInt(document.getElementById('projectProgress').value),
                value: parseFloat(document.getElementById('projectValue').value) || 0,
                description: document.getElementById('projectDescription').value
            };

            // Validate form
            if (!projectData.projectName || !projectData.clientId || !projectData.service) {
                alert('Please fill in all required fields');
                return;
            }

            // Add project
            projects.push(projectData);
            saveData();
            
            // Show success message and return to projects page
            showNotification('Project added successfully!', 'success');
            showProjectsPage();
        }

        function editProject(id) {
            const project = projects.find(p => p.id === id);
            if (!project) return;

            // Show the add project form first
            showAddProjectForm();
            
            // Wait a moment for the form to be rendered, then fill it
            setTimeout(() => {
                // Fill form with project data
                document.getElementById('projectName').value = project.projectName;
                document.getElementById('projectClient').value = project.clientId;
                document.getElementById('projectService').value = project.service;
                document.getElementById('projectDescription').value = project.description;
                document.getElementById('projectValue').value = project.value;
                document.getElementById('projectStartDate').value = project.startDate;
                document.getElementById('projectDueDate').value = project.dueDate;
                document.getElementById('projectStatus').value = project.status;
                document.getElementById('projectProgress').value = project.progress;
                document.getElementById('progressValue').textContent = project.progress + '%';

                // Update form to edit mode
                const submitBtn = document.querySelector('#projectForm button[type="submit"]');
                submitBtn.textContent = 'Update Project';
                
                // Remove existing event listener and add new one
                const form = document.getElementById('projectForm');
                form.removeEventListener('submit', handleProjectSubmit);
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    updateProject(id);
                });
            }, 100);
        }

        function updateProject(id) {
            const projectIndex = projects.findIndex(p => p.id === id);
            if (projectIndex === -1) return;

            const selectedClientId = parseInt(document.getElementById('projectClient').value);
            const selectedClient = clients.find(c => c.id === selectedClientId);

            projects[projectIndex] = {
                ...projects[projectIndex],
                clientId: selectedClientId,
                clientName: selectedClient ? selectedClient.name : 'Unknown Client',
                projectName: document.getElementById('projectName').value,
                service: document.getElementById('projectService').value,
                status: document.getElementById('projectStatus').value,
                startDate: document.getElementById('projectStartDate').value,
                dueDate: document.getElementById('projectDueDate').value,
                progress: parseInt(document.getElementById('projectProgress').value),
                value: parseFloat(document.getElementById('projectValue').value) || 0,
                description: document.getElementById('projectDescription').value
            };

            saveData();
            showProjectsPage();
            showNotification('Project updated successfully!', 'success');
        }

        function deleteProject(id) {
            if (confirm('Are you sure you want to delete this project?')) {
                projects = projects.filter(p => p.id !== id);
                saveData();
                showProjectsPage();
                showNotification('Project deleted successfully!', 'success');
            }
        }

        // Settings page
        function showSettings() {
            const mainContent = document.querySelector('.main-content');
            mainContent.innerHTML = `
                <div class="header">
                    <h1 class="page-title">Settings</h1>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Dashboard Settings</h2>
                    </div>
                    <div class="form-group">
                        <label>Export Data</label>
                        <button class="btn btn-primary" onclick="exportData()">Export All Data</button>
                    </div>
                    <div class="form-group">
                        <label>Import Data</label>
                        <input type="file" class="form-control" id="importFile" accept=".json">
                        <button class="btn btn-primary mt-20" onclick="importData()">Import Data</button>
                    </div>
                    <div class="form-group">
                        <label>Data Management</label>
                        <button class="btn" style="background: var(--info); color: white;" onclick="ensureDataConsistency(); showNotification('Data refreshed successfully!', 'success');">Refresh Data</button>
                        <button class="btn" style="background: var(--danger); color: white; margin-left: 10px;" onclick="resetData()">Reset All Data</button>
                        <button class="btn" style="background: var(--warning); color: white; margin-left: 10px;" onclick="forceResetData()">Force Reset (Clear All)</button>
                    </div>
                </div>
            `;
        }

        // Analytics page
        function showAnalytics() {
            const mainContent = document.querySelector('.main-content');
            const stats = calculateClientStats();
            
            // Calculate revenue by service type
            const revenueByService = calculateRevenueByService();
            
            // Calculate monthly revenue data
            const monthlyRevenue = calculateMonthlyRevenue();
            
            mainContent.innerHTML = `
                <div class="header">
                    <h1 class="page-title">Analytics</h1>
                </div>

                <!-- Revenue Summary Cards -->
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(108, 99, 255, 0.1); color: var(--primary);">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3>KSh ${stats.totalRevenue.toLocaleString()}</h3>
                            <p>Total Revenue</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(40, 167, 69, 0.1); color: var(--success);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3>KSh ${stats.totalProjectValue.toLocaleString()}</h3>
                            <p>Total Project Value</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(255, 193, 7, 0.1); color: var(--warning);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3>KSh ${stats.pendingRevenue.toLocaleString()}</h3>
                            <p>Pending Revenue</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(78, 205, 196, 0.1); color: var(--secondary);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3>${stats.totalClients}</h3>
                            <p>Total Clients</p>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="row" style="margin-top: 30px;">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Revenue by Service Type</h2>
                            </div>
                            <div class="card-body">
                                <canvas id="serviceRevenueChart" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Monthly Revenue</h2>
                            </div>
                            <div class="card-body">
                                <canvas id="monthlyRevenueChart" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Revenue Summary Table -->
                <div class="card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h2 class="card-title">Revenue Summary</h2>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Service Type</th>
                                        <th>Total Projects</th>
                                        <th>Total Value</th>
                                        <th>Revenue Collected</th>
                                        <th>Pending Revenue</th>
                                        <th>Completion Rate</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${renderRevenueSummaryTable(revenueByService)}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;

            // Initialize charts after DOM is updated
            setTimeout(() => {
                renderServiceRevenueChart(revenueByService);
                renderMonthlyRevenueChart(monthlyRevenue);
            }, 100);
        }

        // Calculate revenue by service type
        function calculateRevenueByService() {
            const serviceRevenue = {};
            
            clients.forEach(client => {
                const service = client.service || 'Unknown';
                if (!serviceRevenue[service]) {
                    serviceRevenue[service] = {
                        totalProjects: 0,
                        totalValue: 0,
                        revenueCollected: 0,
                        pendingRevenue: 0
                    };
                }
                
                serviceRevenue[service].totalProjects++;
                serviceRevenue[service].totalValue += client.value || 0;
                serviceRevenue[service].revenueCollected += client.paidAmount || 0;
                serviceRevenue[service].pendingRevenue += (client.value || 0) - (client.paidAmount || 0);
            });
            
            return serviceRevenue;
        }

        // Calculate monthly revenue data
        function calculateMonthlyRevenue() {
            const monthlyData = {};
            const currentDate = new Date();
            
            // Initialize last 6 months
            for (let i = 5; i >= 0; i--) {
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                const monthKey = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                monthlyData[monthKey] = 0;
            }
            
            // Calculate revenue from monthly payments
            clients.forEach(client => {
                if (client.monthlyPayments && Array.isArray(client.monthlyPayments)) {
                    client.monthlyPayments.forEach(payment => {
                        const paymentDate = new Date(payment.date);
                        const monthKey = paymentDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                        if (monthlyData.hasOwnProperty(monthKey)) {
                            monthlyData[monthKey] += payment.amount || 0;
                        }
                    });
                }
            });
            
            return monthlyData;
        }

        // Render revenue summary table for dashboard
        function renderRevenueSummaryTable() {
            const revenueByService = calculateRevenueByService();
            return Object.entries(revenueByService).map(([service, data]) => {
                const averageValue = data.totalProjects > 0 ? (data.totalValue / data.totalProjects) : 0;
                return `
                    <tr>
                        <td><strong>${service}</strong></td>
                        <td>${data.totalProjects}</td>
                        <td>KSh ${data.totalValue.toLocaleString()}</td>
                        <td>KSh ${averageValue.toLocaleString()}</td>
                    </tr>
                `;
            }).join('');
        }

        // Render service revenue pie chart
        function renderServiceRevenueChart(revenueByService) {
            const ctx = document.getElementById('serviceRevenueChart');
            if (!ctx) return;
            
            const labels = Object.keys(revenueByService);
            const data = Object.values(revenueByService).map(service => service.revenueCollected);
            const colors = [
                '#6C63FF', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', 
                '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'
            ];
            
            new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: KSh ${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Render monthly revenue bar chart
        function renderMonthlyRevenueChart(monthlyRevenue) {
            const ctx = document.getElementById('monthlyRevenueChart');
            if (!ctx) return;
            
            const labels = Object.keys(monthlyRevenue);
            const data = Object.values(monthlyRevenue);
            
            new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Monthly Revenue (KSh)',
                        data: data,
                        backgroundColor: 'rgba(108, 99, 255, 0.8)',
                        borderColor: 'rgba(108, 99, 255, 1)',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'KSh ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Revenue: KSh ' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function exportData() {
            const data = {
                clients: clients,
                prospects: prospects,
                projects: projects,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dashboard-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully!', 'success');
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file to import');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.clients && data.prospects) {
                        // Replace all existing data with imported data
                        clients = data.clients || [];
                        prospects = data.prospects || [];
                        projects = data.projects || [];
                        
                        // Save the imported data to localStorage
                        saveData();
                        
                        // Update the UI
                        updateStats();
                        
                        // Show success message
                        showNotification('Data imported successfully! All existing data has been replaced.', 'success');
                        
                        // Clear the file input
                        fileInput.value = '';
                        
                        // Refresh the current page to show the imported data
                        const currentPage = document.querySelector('.page-title');
                        if (currentPage) {
                            const pageTitle = currentPage.textContent;
                            switch(pageTitle) {
                                case 'Dashboard':
                                    showDashboard();
                                    break;
                                case 'Clients':
                                    showClients();
                                    break;
                                case 'Projects':
                                    showProjectsPage();
                                    break;
                                case 'Analytics':
                                    showAnalytics();
                                    break;
                                case 'Outreach':
                                    showOutreach();
                                    break;
                            }
                        }
                    } else {
                        alert('Invalid data format. Please make sure the file contains clients, prospects, and projects data.');
                    }
                } catch (error) {
                    alert('Error reading file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function resetData() {
            if (confirm('Are you sure you want to reset all data? This action cannot be undone.')) {
                // Clear all data from localStorage
                localStorage.removeItem('clients');
                localStorage.removeItem('prospects');
                localStorage.removeItem('projects');
                
                // Clear all data arrays
                clients = [];
                prospects = [];
                projects = [];
                
                // Save empty data to localStorage
                saveData();
                
                // Show notification and refresh
                showNotification('All data has been reset successfully!', 'success');
                location.reload();
            }
        }


        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : 'var(--primary)'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Mobile sidebar functions
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function closeSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        }

        // Close sidebar when menu item is clicked on mobile
        function handleMobileMenuClick() {
            if (window.innerWidth <= 768) {
                closeSidebar();
            }
        }

        // Ensure data consistency across all views
        function ensureDataConsistency() {
            // Reload data from localStorage to ensure we have the latest
            clients = JSON.parse(localStorage.getItem('clients')) || [];
            prospects = JSON.parse(localStorage.getItem('prospects')) || [];
            projects = JSON.parse(localStorage.getItem('projects')) || [];
            
            console.log('Data refreshed - Clients:', clients.length, 'Prospects:', prospects.length, 'Projects:', projects.length);
        }

        // Refresh data on window resize to ensure consistency between desktop and mobile
        function refreshDataOnResize() {
            // Ensure data is fresh
            ensureDataConsistency();
            
            // Get current page
            const currentPage = document.querySelector('.page-title');
            if (currentPage) {
                const pageTitle = currentPage.textContent;
                switch(pageTitle) {
                    case 'Dashboard':
                        showDashboard();
                        break;
                    case 'Clients':
                        showClients();
                        break;
                    case 'Projects':
                        showProjectsPage();
                        break;
                    case 'Analytics':
                        showAnalytics();
                        break;
                    case 'Outreach':
                        showOutreach();
                        break;
                    case 'Settings':
                        showSettings();
                        break;
                }
            }
        }

        // Initialize the dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - Initializing dashboard');
            ensureDataInitialized();
            initializeSidebar();
            initializeTabs();
            initializeForms();
            initializeSearch();
            updateStats();
            renderCharts();
            console.log('Dashboard initialization complete');
        });

        // Add window resize listener to refresh data when switching between desktop and mobile
        window.addEventListener('resize', function() {
            // Debounce the resize event to avoid too many calls
            clearTimeout(window.resizeTimeout);
            window.resizeTimeout = setTimeout(refreshDataOnResize, 250);
        });
    </script>
</body>
</html>